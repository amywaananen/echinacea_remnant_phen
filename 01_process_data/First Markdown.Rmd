---
title: "Phen Flowering Time"
author: "Qingyuan Liu"
date: "2021/3/14"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This project aims to compare the flower duration of populations of Echinacea by sites in Western Minnesota.

```{r pacakages, message=FALSE, warning=FALSE}
library(here)
library(dplyr)
library(tidyr)
library(tidyverse)
```

The raw data consists of two datasets: headIDtoAKA20190612.csv (explore) 
and remPhenologyThru2019_20200909.csv (explore2)

```{r}
explore <- read.csv(here('00_raw_data/headIdToAKA20190612.csv'))
explore2 <- read.csv(here('00_raw_data/remPhenologyThru2019_20200909.csv'))
head(explore)
head(explore2)
```

These two files contain the information of Echinacea populations, including their flower time. but We need to merge the two files into 1 file for further exploration.

```{r tidy, echo=TRUE, message=FALSE, warning=FALSE, paged.print=TRUE}
alldata <- merge(explore, explore2, by = "headID")
summary(alldata)
tidy <- (select(alldata, headID, site, year.y, startDtEarly,startDtLate, endDtEarly, endDtLate))
summary(tidy)
```

Since the flower duration need to be calculated from the start and end date, the date columns need to be separated into year, monnth and date.

```{r}
Duration <- tidy %>% 
  mutate(duration = as.Date(endDtEarly) - as.Date(startDtEarly))
summary(Duration)
```

Now dataset Duration is ready to be analyzed since it contains all the information needed, including the duration of flower time. 
But there are some columns containing "N/A", and some unavailable date that makes the result invalid.
In addition, there are some sites taht only contain 1 data, which makes the ANOVA analysis not significant.
We can clear all such rows first.
```{r}
nrow(Duration)
Dur_tidy <- Duration%>% 
  filter(duration > -1)%>%
  filter(duration < 50)%>%
  filter(site != "Other")%>%
  filter(site != "sign")%>%
  filter(site != "KJs")%>%
  filter(site != "tp")%>%
  filter(site != "yard")%>%
  drop_na()
nrow(Dur_tidy)
```

All the sites contained in the raw data is shown below:

```{r}
unique(Dur_tidy$site)
```

Summarize the average flower duration according to sites:

```{r paged.print=TRUE}
Sum <- Dur_tidy%>%
  group_by(site)%>%
  summarise(avg_dur = mean(duration),sd_duration = sd(duration))

Dur_tidy%>%
  group_by(site)%>%
  summarise(avg_dur = mean(duration),sd_duration = sd(duration))
```

Now we can start performing an One-way ANOVA test to see if the site has any impact on the flower time.
(Or if the flower time diverges in different sites.)

```{r}
one.way <- aov(duration ~ site, data = Dur_tidy)
summary(one.way)
```

The result shows that variance does exist for the duration of flower in different sites, and the difference is statistically significant.

The graph shows how the mean and standard deviation of each site group compare.

```{r}
ggplot(data = Dur_tidy)+
  geom_boxplot(mapping = aes(x = site, y = duration))+
  coord_flip()
```

ANOVA test can also be done on the start and end date of the flower time
```{r}
one.way2 <- aov(as.Date(startDtLate) ~ site, data = Dur_tidy)
summary(one.way2)
one.way3 <- aov(as.Date(endDtEarly) ~ site, data = Dur_tidy)
summary(one.way3)
```

```{r}
ggplot(data = Dur_tidy)+
  geom_boxplot(mapping = aes(x = site, y = as.Date(startDtLate)))+
  coord_flip()

ggplot(data = Dur_tidy)+
  geom_boxplot(mapping = aes(x = site, y = as.Date(endDtEarly)))+
  coord_flip()
```